# Original source code:
# https://github.com/Birdabo404/suifetch
# (I will be using this as reference to make my own
# simplified neofetch clone for testing/example purposes)

require("stdio")
require("unistd")
require("stdlib")
require("fcntl")


def main(args):
    ascii_art = "|\\---/|\n| o_o |\n \\_^_/"
    print(ascii_art)

    fd = open("/etc/os-release", O_RDONLY)

    if fd < 0:
        perror("Unable to read OS release file")
        return 1

    result = read(fd)

    if result is None:
        perror("Unable to read OS release file")
        return 1

    lines = result.split("\n")

    OS_NAME = "os: "

    # Find the line that starts with "PRETTY_NAME="
    for line in lines:
        if line.startswith("PRETTY_NAME="):
            OS_NAME += line.split("=")[1].replace('"', "")
            break
    else:
        OS_NAME = "OS Information not available!"

    #close(fd) TODO: Implement

    print(OS_NAME)

    username = getenv("USER")
    print(f"username: {username}")

    shell = getenv("SHELL")
    print(f"shell: {shell}")

    return 0
