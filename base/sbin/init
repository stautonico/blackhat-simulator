require("stdlib")
require("dirent")
require("unistd")
require("stdio")
require("pwd")

def main(argv):
    print("blackhat-simulator 0.0.0 (tty0)")
    print("")

    # TODO: Disable this
    # Bypass login for dev
    return execve("/bin/sh", [], {})

    while True:
        username = input("<hostname> login: ")
        password = input("Password: ")

        result = getpwnam(username)

        if result is None:
            print("Login Incorrect")
            continue
        else:
            # TODO: Hash the inputted password and compare
            if password == result.pw_passwd:
                # TODO: Set UID
                # TODO: Spawn the user's shell
                return execve("/bin/sh", [], {})
            else:
                print("Login Incorrect")
                continue

    # We should never reach here! (just in case)
    return -1





# TODO Make login:
"""
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <sys/types.h>
#include <pwd.h>

int main() {
    const char *username = "test_user";

    struct passwd *user_info = getpwnam(username);

    if (user_info != NULL) {
        // Replace this with the actual password you want to check
        const char *entered_password = "user_password";

        // Hash the entered password with the salt from the stored hash
        char *hashed_password = crypt(entered_password, user_info->pw_passwd);

        // Compare the stored hash with the newly hashed entered password
        if (strcmp(user_info->pw_passwd, hashed_password) == 0) {
            printf("Password is correct.\n");
        } else {
            printf("Password is incorrect.\n");
        }
    } else {
        fprintf(stderr, "User not found.\n");
    }

    return 0;
}
"""